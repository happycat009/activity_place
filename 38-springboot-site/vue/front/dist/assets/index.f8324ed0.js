var w=Object.defineProperty,x=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var M=(e,a,t)=>a in e?w(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,i=(e,a)=>{for(var t in a||(a={}))I.call(a,t)&&M(e,t,a[t]);if(P)for(var t of P(a))j.call(a,t)&&M(e,t,a[t]);return e},_=(e,a)=>x(e,D(a));/* empty css             *//* empty css                    */import{_ as h}from"./plugin-vue_export-helper.21dcd24c.js";import{o as b,q as f,d as n,ac as S,ad as U,y as k,x as N,w as m,A as u,B as C,C as $,ae as B,af as q,a as v}from"./vendor.94a1cd75.js";import{_ as y}from"./YhPagination.54041a25.js";/* empty css                        *//* empty css               *//* empty css                  *//* empty css                  */import{a as z}from"./index.4c3bf3be.js";import{r as E,a as V}from"./requestB413.a1b04189.js";import{_ as Y,r as O}from"./YhTable.0f5492ae.js";import{h as R}from"./moment.08a7f518.js";/* empty css                      *//* empty css                 *//* empty css                  *//* empty css                     *//* empty css                   */const F={name:"MessageToolbar",props:{unSeeNum:{type:[Number],default:()=>0}},data(){return{unSeeChecked:!1}},watch:{unSeeChecked:{handler(e){this.$emit("updateParam",{issee:e?"0":""})}}}},H={class:"toolbar"};function L(e,a,t,d,o,l){const c=S;return b(),f("div",H,[n(c,{modelValue:o.unSeeChecked,"onUpdate:modelValue":a[0]||(a[0]=r=>o.unSeeChecked=r),label:`\u4EC5\u5C55\u793A\u672A\u8BFB\u6D88\u606F\uFF08${t.unSeeNum}\u9879\uFF09`,size:"large"},null,8,["modelValue","label"])])}var A=h(F,[["render",L],["__scopeId","data-v-4dd3ebf0"]]);const G={name:"MessageTableMessage",components:{YhTable:Y,YhPagination:y},props:{toolbarParam:{type:[Object],required:!0,default:()=>{}}},data(){return{tableData:[],tablePageInfo:{pageNo:1,pageSize:10},pageInfo:{pageNo:1,pageSize:10,total:0},multipleTableRef:null,messageDetail:{title:"",content:"",dialogVisible:!1},messageUnreadCount:0}},mounted(){this.userCodeTableMap("yesorno")},methods:{getDateFormatted(e,a){return R(e).format(a)},loadTableData(){let e=this,{pageNo:a,pageSize:t,aab001:d,issee:o}=e.queryParam;!a||!t||!d||E(a,t,d,o).then(l=>{const{code:c,data:r}=l;if(c=="200"){const{messageList:p,messagePageInfo:g,unMarkMessageCount:s}=r;console.log("messageList",p),console.log("messagePageInfo",g),console.log("unMarkMessageCount",s),e.tableData=p,e.pageInfo=g,e.messageUnreadCount=s}})},pageInfoChange(e){const{currentPage:a,pageSize:t}=e;this.pageInfo.pageNo=a,this.pageInfo.pageSize=t,this.tablePageInfo.pageNo=a,this.tablePageInfo.pageSize=t},readMessage(e){const{aab001:a}=this.corporateInfo,{mgid:t}=e;V(a,t).then(d=>{this.loadTableData()})},showMessageDetail(e){U.alert(e,"\u6D88\u606F\u5185\u5BB9",{dangerouslyUseHTMLString:!0})},loadMessageDetail(){const{aab001:e}=this.corporateInfo,{mgid:a}=this.messageDetail;O(e,a).then(t=>{const{code:d,data:o}=t;d=="200"&&(this.messageDetail=i(i({},this.messageDetail),o),this.messageDetail.issee!="1"&&this.readMessage(this.messageDetail))})}},computed:_(i({},k([z])),{queryParam(){let e=i({},this.toolbarParam);return _(i(i({},e),this.tablePageInfo),{aab001:this.corporateInfo.aab001})}}),watch:{queryParam:{handler(e){this.loadTableData()},immediate:!0,deep:!0},messageUnreadCount:{handler(e){this.$emit("updateMessageUnreadCount",e)},immediate:!0}}},J={class:"message-table-wrapper"},K={class:"table-wrapper"},Q=u("\u6807\u8BB0\u4E3A\u5DF2\u8BFB"),W=u("\u67E5\u770B\u5185\u5BB9");function X(e,a,t,d,o,l){const c=$,r=B,p=q,g=y;return b(),f("div",J,[N("div",K,[n(p,{height:"500px",ref:"multipleTableRef",data:o.tableData,style:{width:"100%"},onSelectionChange:e.handleSelectionChange},{default:m(()=>[n(r,{label:"\u64CD\u4F5C","header-align":"center",align:"center",width:"120"},{default:m(s=>[n(c,{type:"primary",disabled:s.row.issee==1,onClick:T=>l.readMessage(s.row)},{default:m(()=>[Q]),_:2},1032,["disabled","onClick"])]),_:1}),n(r,{label:"\u72B6\u6001","header-align":"center",align:"center",width:"100"},{default:m(s=>[u(C(s.row.issee==1?"\u5DF2\u8BFB":"\u672A\u8BFB"),1)]),_:1}),n(r,{label:"\u6D88\u606F\u4E3B\u9898",width:"200"},{default:m(s=>[u(C(s.row.title),1)]),_:1}),n(r,{label:"\u6D88\u606F\u5185\u5BB9",width:"360"},{default:m(s=>[n(c,{type:"primary",onClick:T=>l.showMessageDetail(s.row.content)},{default:m(()=>[W]),_:2},1032,["onClick"])]),_:1}),n(r,{label:"\u63A5\u6536\u65F6\u95F4","header-align":"center",align:"center",width:"160"},{default:m(s=>[u(C(l.getDateFormatted(s.row.mgdate,"yyyy-MM-DD HH:mm:ss")),1)]),_:1})]),_:1},8,["data","onSelectionChange"]),n(g,{total:Number(o.pageInfo.total),onPagination:l.pageInfoChange,"page-sizes":["1","10","20","30"]},null,8,["total","onPagination"])])])}var Z=h(G,[["render",X]]);const ee={name:"MessageIndex",components:{Toolbar:A,TableMessage:Z},data(){return{toolbarParam:{},messageUnreadCount:0}},methods:{updateParam(e){this.toolbarParam=i(i({},this.toolbarParam),e)},updateMessageUnreadCount(e){this.messageUnreadCount=e}}},ae={class:"enterprise-message"};function te(e,a,t,d,o,l){const c=v("Toolbar"),r=v("TableMessage");return b(),f("div",ae,[n(c,{onUpdateParam:l.updateParam,unSeeNum:o.messageUnreadCount},null,8,["onUpdateParam","unSeeNum"]),n(r,{toolbarParam:o.toolbarParam,onUpdateMessageUnreadCount:l.updateMessageUnreadCount},null,8,["toolbarParam","onUpdateMessageUnreadCount"])])}var ve=h(ee,[["render",te],["__scopeId","data-v-91fc8236"]]);export{ve as default};
