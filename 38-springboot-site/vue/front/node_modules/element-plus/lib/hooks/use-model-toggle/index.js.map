{"version":3,"file":"index.js","sources":["../../../../../packages/hooks/use-model-toggle/index.ts"],"sourcesContent":["import { computed, getCurrentInstance, watch, onMounted } from 'vue'\nimport { isFunction } from '@vue/shared'\nimport { isClient } from '@vueuse/core'\nimport { isBool } from '@element-plus/utils/util'\nimport { UPDATE_MODEL_EVENT } from '@element-plus/utils/constants'\nimport { buildProps, definePropType } from '@element-plus/utils/props'\nimport type { RouteLocationNormalizedLoaded } from 'vue-router'\n\nimport type { Ref, ComponentPublicInstance, ExtractPropTypes } from 'vue'\n\nexport const useModelToggleProps = buildProps({\n  modelValue: {\n    type: definePropType<boolean | null>(Boolean),\n    default: null,\n  },\n  'onUpdate:modelValue': Function,\n})\nexport type UseModelToggleProps = ExtractPropTypes<typeof useModelToggleProps>\n\nexport const useModelToggleEmits = [UPDATE_MODEL_EVENT]\n\nexport type ModelToggleParams = {\n  indicator: Ref<boolean>\n  shouldHideWhenRouteChanges?: Ref<boolean>\n  shouldProceed?: () => boolean\n  onShow?: () => void\n  onHide?: () => void\n}\n\nexport const useModelToggle = ({\n  indicator,\n  shouldHideWhenRouteChanges,\n  shouldProceed,\n  onShow,\n  onHide,\n}: ModelToggleParams) => {\n  const instance = getCurrentInstance()!\n  const props = instance.props as UseModelToggleProps & { disabled: boolean }\n  const { emit } = instance\n\n  const hasUpdateHandler = computed(() =>\n    isFunction(props['onUpdate:modelValue'])\n  )\n  // when it matches the default value we say this is absent\n  // though this could be mistakenly passed from the user but we need to rule out that\n  // condition\n  const isModelBindingAbsent = computed(() => props.modelValue === null)\n\n  const doShow = () => {\n    if (indicator.value === true) {\n      return\n    }\n\n    indicator.value = true\n    if (isFunction(onShow)) {\n      onShow()\n    }\n  }\n\n  const doHide = () => {\n    if (indicator.value === false) {\n      return\n    }\n\n    indicator.value = false\n\n    if (isFunction(onHide)) {\n      onHide()\n    }\n  }\n\n  const show = () => {\n    if (\n      props.disabled === true ||\n      (isFunction(shouldProceed) && !shouldProceed())\n    )\n      return\n\n    const shouldEmit = hasUpdateHandler.value && isClient\n\n    if (shouldEmit) {\n      emit(UPDATE_MODEL_EVENT, true)\n    }\n\n    if (isModelBindingAbsent.value || !shouldEmit) {\n      doShow()\n    }\n  }\n\n  const hide = () => {\n    if (props.disabled === true || !isClient) return\n\n    const shouldEmit = hasUpdateHandler.value && isClient\n\n    if (shouldEmit) {\n      emit(UPDATE_MODEL_EVENT, false)\n    }\n\n    if (isModelBindingAbsent.value || !shouldEmit) {\n      doHide()\n    }\n  }\n\n  const onChange = (val: boolean) => {\n    if (!isBool(val)) return\n    if (props.disabled && val) {\n      if (hasUpdateHandler.value) {\n        emit(UPDATE_MODEL_EVENT, false)\n      }\n    } else if (indicator.value !== val) {\n      if (val) {\n        doShow()\n      } else {\n        doHide()\n      }\n    }\n  }\n\n  const toggle = () => {\n    if (indicator.value) {\n      hide()\n    } else {\n      show()\n    }\n  }\n\n  watch(() => props.modelValue, onChange as any)\n\n  if (\n    shouldHideWhenRouteChanges &&\n    instance.appContext.config.globalProperties.$route !== undefined\n  ) {\n    watch(\n      () => ({\n        ...(\n          instance.proxy as ComponentPublicInstance<{\n            $route: RouteLocationNormalizedLoaded\n          }>\n        ).$route,\n      }),\n      () => {\n        if (shouldHideWhenRouteChanges.value && indicator.value) {\n          hide()\n        }\n      }\n    )\n  }\n\n  onMounted(() => {\n    onChange(props.modelValue as boolean)\n  })\n\n  return {\n    hide,\n    show,\n    toggle,\n  }\n}\n"],"names":["buildProps","definePropType","UPDATE_MODEL_EVENT","getCurrentInstance","computed","isFunction","isClient","isBool","watch","onMounted"],"mappings":"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"}